<!DOCTYPE html style = "padding: 0px; margin: 0px;">
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>EvalPal</title>
    <!-- MDB icon -->
    <link rel="icon" href="/img/evalpalmain.ico" type="image/x-icon">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" href="/css/mdb.min.css">
    <!-- Your custom styles (optional) -->
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    </head>
    <body style = "padding: 0px; margin: 0px;">
        <header style = "padding: 0px; margin: 0px; background-color: rgba(0, 48, 78, 1)7">
            <nav id = "navigation" class="navbar sticky-top navbar-dark navbar-expand-sm" style = "background-color: rgba(0, 48, 78, 1)">
              <!--<img src="https://scalar.usc.edu/works/new-and-improved/media/cwru_stacked_logo_blue_no_tag.jpg" height="30" class="d-inline-block align-top"
              alt="Case Western logo">-->
              <a class="navbar-brand header-image w-5 " href="#"><img src="img/header.png" class="w-50" alt=""></a>
              <form class="form-inline my-2 my-lg-0 ml-auto">
                <form class="form-inline" action = "./Options" method = "POST">
                    <div class="md-form my-0">
                      <div><input class="form-control wow" type="text" placeholder="Search" aria-label="Search"></div>
                    </div>
                    <button class="btn btn-outline-white btn-md my-2 my-sm-0 ml-3">Search</button>
                </form>
              </form>
            </nav>
          </header>
    <!-- Start your project here-->
        <div id = "section1">
            <div class = "mask rgba-indigo-strong" style = "height: 100%">
            <div style = "background-color: transparent; height: 10%; width: 100%"></div>
            <h2 class = "wow fadeInDown" style = "display: flex; justify-content: center; text-align: center; align-items: center; font-size: 50px; color: white">Results for "<%=data%>"</h2>
            <div style = "height: 4%"></div>
            <div style = "width: 60%; margin-left:20%; background-color: rgb(1, 35, 56); opacity: .85; z-index: 2; position: absolute">
                <div id = "results" style = "width: 80%; margin-left:10%">
                    <div class = "row" style = "width: 100%; padding-top: 2%; border-bottom-style: solid; border-width: 2px; border-color: rgba(42, 45, 202, 0.753)">
                        <div class = "col" style = "background-color: transparent; display: flex; justify-content: center; align-items: center; color: white; font-size:25px; font-weight: bolder;">Professor</div>
                        <div class = "col" style = "background-color: transparent; display: flex; justify-content: center; align-items: center; color: white; font-size:25px; font-weight: bolder">Class</div>
                    </div>
                </div>
                <div style = "height: 4%; width: 100%; padding: 2%"></div>
                <h2 style = "display: flex; justify-content: center; align-items: center; font-size: 30px; color: white"></h2>
                <div style = "height: 7%; width: 100%; padding: 2%"></div>
                <div>
                    <form autocomplete="off" id = "try-again-form" action = "./Options"  method = "POST">
                        <div class = "row" style = "width: 100%; margin: 0px; padding: 0px">
                            <div class = "col-lg-2"></div>
                            <div class = "col-lg-8 row no-gutters justify-content-center">
                            <div class = "autocomplete-div">
                            <div><input style = "overflow: hidden; position: relative;" value = "" size = "40" id = "user-search-input" class="form-control wow" type="text" name = "searched" placeholder="Search a class or professor" aria-label="Search"></div>
                            <div><button type = "button" style = "visibility: hidden" class="form-control button-fixup" id = "first-suggestion"></button></div>
                            <div><button type = "button" style = "visibility: hidden" class="form-control button-fixup" id = "second-suggestion"></button></div>
                            <div><button type = "button" style = "visibility: hidden" class="form-control button-fixup" id = "third-suggestion"></button></div>
                            <div style = "height: 1%; width: 100%; padding: 2%"></div>
                            </div>
                            <div><button class="btn aqua-gradient btn-rounded btn-md my-0" type="submit">Search</button></div>
                            </div>
                            <div class = "col-lg-2"></div>
                        </div>
                            
                        </div>
                    </form>
                </div>
            </div>
        </div>
    

    <!-- jQuery -->
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="/js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="/js/mdb.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <!-- Your custom scripts (optional) -->
    <script>$(document).ready(function() {
        new WOW().init();
        });

        var request = new XMLHttpRequest();
        var userInput = "<%= data %>";
        request.open('GET', '../api/professor/' + userInput, true); 
        request.onload = function(){
            var i = 0;
            var colOne;
            var colTwo;
            data = JSON.parse(this.response);
            var loggedData = new Array(0);
            if (request.status >= 200 && request.status < 400) {
                for(i = 0; i < data.length; i++){
                    loggedData.push([data[i].subject + " " + data[i].catalog_nbr, data[i].instructor_name]);
                }
                var uniques = [];
                var itemsFound = {};
                for(i = 0; i < loggedData.length; i++) {
                    var stringified = JSON.stringify(loggedData[i]);
                    if(itemsFound[stringified]) { continue; }
                    uniques.push(loggedData[i]);
                    itemsFound[stringified] = true;
                }
                for (i = 0; i < uniques.length; i++){
                    row = document.createElement('a');
                    row.setAttribute("style", "width: 100%");
                    row.setAttribute("class", "row rounded-lg");
                    colOne = document.createElement('div');
                    colTwo = document.createElement('div');
                    colOne.setAttribute("class", "col result-option subject-hover");
                    colTwo.setAttribute("class", "col prof-hover result-option");
                    colOne.setAttribute("style", "width: 100%; text-align: center; line-height: inherit; padding: 2%; border-radius: 5px;");
                    colTwo.setAttribute("style", "width: 100%; text-align: center; line-height: inherit; padding: 2%; border-radius: 5px;");
                    colOne.innerText = uniques[i][0];
                    colTwo.innerText = uniques[i][1];
                    profName = uniques[i][1];
                    profName = hyphenate(profName);
                    colOne.setAttribute("onclick", "location.href = '../professor/"+profName+"?subject="+uniques[i][0].substring(0,3)+"&catalog_nbr="+uniques[i][0].substring(3, uniques[i].length)+"'");
                    colTwo.setAttribute("onclick", "location.href = '../professor/"+profName+"'");
                    row.appendChild(colTwo);
                    row.appendChild(colOne);
                    document.getElementById("results").appendChild(row);
                }
            }
            if(document.body.scrollHeight > document.getElementById("section1").offsetHeight){
                    div = document.createElement('div');
                    div.setAttribute("style", "overflow-y: auto; height: " + (document.body.scrollHeight - document.getElementById("section1").offsetHeight) + "px");
                    div.setAttribute("id", "section2");
                    document.body.appendChild(div);
                    window.scrollTo(0, 0);
                }
        }

        window.addEventListener("resive", function(event){
            if(document.body.scrollHeight > document.getElementById("section1").offsetHeight){
                    div = document.createElement('div');
                    div.setAttribute("style", "overflow-y: auto; height: " + (document.body.scrollHeight - document.getElementById("section1").offsetHeight) + "px");
                    div.setAttribute("id", "section2");
                    document.body.appendChild(div);
                    window.scrollTo(0, 0);
                }
        });

        function hyphenate(profName){
            let hyphenatedName = "";
            for(let index = 0; index < profName.length; index++){
                if(profName[index]==' '){
                    hyphenatedName = hyphenatedName + "_"
                }
                else
                    hyphenatedName = hyphenatedName + profName[index];
            }
            return hyphenatedName;
        }

        searchBarInput = document.getElementById("user-search-input");
        var count = 0;
        var optionsArr;
        let filteredArr = [];
        var firstSuggestion = document.getElementById("first-suggestion");
        var secondSuggestion = document.getElementById("second-suggestion");
        var thirdSuggestion = document.getElementById("third-suggestion");
        var suggestionsArr = [firstSuggestion, secondSuggestion, thirdSuggestion];
        var newFilteredArr;
        var searchUniques = [];
        var itemsFound = {};

        searchBarInput.addEventListener("input", async function(event){
            if(event.target.value.length == 1){
                optionsArr = await fetch(`../api/professor/${event.target.value}`);
                optionsArr = await optionsArr.json();
                for(i = 0; i < optionsArr.length; i++){
                    filteredArr.push(optionsArr[i].instructor_name);
                }
            }
            else{
                newFilteredArr = filteredArr.filter(option => option.toLowerCase().includes(event.target.value.toLowerCase()));
                searchUniques = [];
                itemsFound = {};
                for(i = 0; i < newFilteredArr.length; i++) {
                    var stringified = JSON.stringify(newFilteredArr[i]);
                    if(itemsFound[stringified]) { continue; }
                    searchUniques.push(newFilteredArr[i]);
                    itemsFound[stringified] = true;
                }
            }
            for(i = 0; i < searchUniques.length && i < 3; i++){
                suggestionsArr[i].innerHTML = "<i class='fa fa-search'></i>" + searchUniques[i];
                suggestionsArr[i].setAttribute("style", "visibility: visible; border-radius: 0px");
            }
            for(var i = searchUniques.length; i < 3; i++){
                suggestionsArr[i].setAttribute("style", "visibility: hidden");
            }
        });
        for(var i = 0; i < suggestionsArr.length; i++){
            console.log(suggestionsArr[i]);
            suggestionsArr[i].addEventListener("click", function(event){
                if(event.target.getAttribute("style").includes("visible")){
                    searchBarInput.value = event.target.innerText;
                    var form = document.getElementById("try-again-form");
                    form.submit();
                }
            });
        }
        request.send(); 
    </script>


</body>
</html>